gsap.registerPlugin(ScrollTrigger);
gsap.defaults({ ease: "power1.inOut", duration: 0.8 });

function setupParallaxAnimations() {
    // Hero balls floating animation
    gsap.utils.toArray(".hero .ball").forEach((ball, i) => {
        gsap.to(ball, {
            y: `random(-30, 30)`,
            x: `random(-30, 30)`,
            scale: `random(0.9, 1.1)`,
            rotation: `random(-10, 10)`,
            duration: `random(4, 6)`,
            repeat: -1,
            yoyo: true,
            ease: "sine.inOut",
            delay: i * 0.2
        });
    });

    // News section title animations
    gsap.from(".news-title span", {
        scrollTrigger: {
            trigger: "#news",
            start: "top 85%",
            end: "top 40%",
            scrub: 1.5
        },
        opacity: 0,
        y: 50,
        scale: 0.95
    });

    gsap.from(".news-title h2", {
        scrollTrigger: {
            trigger: "#news",
            start: "top 85%",
            end: "top 35%",
            scrub: 2
        },
        opacity: 0,
        y: 70,
        scale: 0.9
    });

    gsap.from(".about__pic", {
        scrollTrigger: {
            trigger: "#news",
            start: "top 75%",
            end: "top 20%",
            scrub: 2.5
        },
        opacity: 0,
        x: -100,
        y: 40,
        scale: 0.9
    });

    // News items timeline
    const newsItems = gsap.timeline({
        scrollTrigger: {
            trigger: "#news",
            start: "top 65%",
            toggleActions: "play none none reverse"
        }
    });

    newsItems
        .from(".news__item__icon", {
            scale: 0,
            opacity: 0,
            duration: 0.8,
            ease: "back.out(1.5)",
            stagger: 0.1
        }, 0)
        .from(".news__subtitle", {
            opacity: 0,
            x: 40,
            duration: 0.7,
            stagger: 0.1
        }, "-=0.6")
        .from(".about__text__desc", {
            opacity: 0,
            y: 30,
            duration: 0.7,
            stagger: 0.1
        }, "-=0.5");

    // Resume section
    gsap.from("#resume .section-title", {
        scrollTrigger: {
            trigger: "#resume",
            start: "top 80%",
            end: "top 35%",
            scrub: 2
        },
        opacity: 0,
        y: 80,
        scale: 0.9
    });

    gsap.from("#resume .col-lg-6:first-child .resume-title", {
        scrollTrigger: {
            trigger: "#resume",
            start: "top 65%",
            end: "top 45%",
            scrub: 1.5
        },
        opacity: 0,
        x: -80,
        stagger: 0.15
    });

    gsap.from("#resume .col-lg-6:first-child .resume-item", {
        scrollTrigger: {
            trigger: "#resume",
            start: "top 65%",
            toggleActions: "play none none reverse"
        },
        opacity: 0,
        x: -60,
        y: 20,
        scale: 0.95,
        duration: 0.7,
        stagger: 0.1
    });

    gsap.from("#resume .col-lg-6:last-child .resume-title", {
        scrollTrigger: {
            trigger: "#resume",
            start: "top 65%",
            end: "top 45%",
            scrub: 1.5
        },
        opacity: 0,
        x: 80,
        stagger: 0.15
    });

    gsap.from("#resume .col-lg-6:last-child .resume-item", {
        scrollTrigger: {
            trigger: "#resume",
            start: "top 65%",
            toggleActions: "play none none reverse"
        },
        opacity: 0,
        x: 60,
        y: 20,
        scale: 0.95,
        duration: 0.7,
        stagger: 0.1
    });

    // Team section
    gsap.from(".team__title", {
        scrollTrigger: {
            trigger: ".team",
            start: "top 75%",
            end: "top 35%",
            scrub: 2
        },
        opacity: 0,
        y: 80,
        scale: 0.9
    });

    gsap.utils.toArray(".team__item").forEach((item, i) => {
        gsap.from(item, {
            scrollTrigger: {
                trigger: item,
                start: "top 80%",
                end: "top 50%",
                scrub: 1.5
            },
            opacity: 0,
            y: 60 + (i * 10),
            scale: 0.9
        });
    });

    gsap.from(".team__btn", {
        scrollTrigger: {
            trigger: ".team",
            start: "top 50%",
            toggleActions: "play none none reverse"
        },
        opacity: 0,
        scale: 0.9,
        y: 20,
        duration: 0.7,
        ease: "back.out(1.2)"
    });

    // Services section
    gsap.from("#services .services__title", {
        scrollTrigger: {
            trigger: "#services",
            start: "top 75%",
            end: "top 35%",
            scrub: 2
        },
        opacity: 0,
        x: -80,
        scale: 0.9
    });

    gsap.utils.toArray("#services .services__item").forEach((item, i) => {
        gsap.from(item, {
            scrollTrigger: {
                trigger: item,
                start: "top 75%",
                end: "top 40%",
                scrub: 1.5
            },
            opacity: 0,
            y: 50 + (i % 2 * 15),
            x: (i % 2 === 0 ? -20 : 20),
            scale: 0.95
        });

        gsap.from(item.querySelector(".services__item__icon"), {
            scrollTrigger: {
                trigger: item,
                start: "top 75%",
                toggleActions: "play none none reverse"
            },
            scale: 0,
            rotation: 360,
            opacity: 0,
            duration: 0.8,
            ease: "back.out(1.5)",
            delay: 0.15
        });
    });

    // Skills section
    gsap.from("#skills .section-title", {
        scrollTrigger: {
            trigger: "#skills",
            start: "top 80%",
            end: "top 35%",
            scrub: 2
        },
        opacity: 0,
        y: 80,
        scale: 0.9
    });

    gsap.utils.toArray(".skills-item").forEach((item, i) => {
        const direction = i % 2 === 0 ? -1 : 1;
        const offset = 60;

        const mainTl = gsap.timeline({
            scrollTrigger: {
                trigger: item,
                start: "top 80%",
                end: "top 30%",
                scrub: 1.8
            }
        });

        mainTl.fromTo(item,
            {
                opacity: 0,
                x: direction * offset,
                y: 60,
                scale: 0.9
            },
            {
                opacity: 1,
                x: 0,
                y: 0,
                scale: 1
            }
        );

        gsap.from(item.querySelector(".skills-icon"), {
            scrollTrigger: {
                trigger: item,
                start: "top 75%",
                toggleActions: "play none none reverse"
            },
            scale: 0,
            rotation: 360,
            opacity: 0,
            duration: 0.8,
            ease: "back.out(1.3)",
            delay: 0.2
        });

        gsap.fromTo(item.querySelectorAll(".tool"),
            {
                opacity: 0,
                scale: 0.9,
                y: 15
            },
            {
                scrollTrigger: {
                    trigger: item,
                    start: "top 70%",
                    toggleActions: "play none none reverse"
                },
                opacity: 1,
                scale: 1,
                y: 0,
                duration: 0.4,
                stagger: 0.06,
                delay: 0.35
            }
        );
    });

    // Projects section
    gsap.from("#projects .section-title", {
        scrollTrigger: {
            trigger: "#projects",
            start: "top 80%",
            end: "top 35%",
            scrub: 2
        },
        opacity: 0,
        scale: 0.9,
        y: 80
    });

    gsap.utils.toArray(".portfolio__item").forEach((item, i) => {
        const row = Math.floor(i / 3);
        const col = i % 3;

        gsap.from(item, {
            scrollTrigger: {
                trigger: item,
                start: "top 85%",
                end: "top 40%",
                scrub: 1.5
            },
            opacity: 0,
            y: 70 + (row * 20),
            x: (col - 1) * 30,
            scale: 0.9
        });

        gsap.from(item.querySelector(".portfolio__item__image"), {
            scrollTrigger: {
                trigger: item,
                start: "top 80%",
                end: "top 40%",
                scrub: 2
            },
            scale: 1.1,
            opacity: 0.7
        });
    });

    // Contact section
    gsap.from("#contact .section-title", {
        scrollTrigger: {
            trigger: "#contact",
            start: "top 80%",
            end: "top 40%",
            scrub: 2
        },
        opacity: 0,
        y: 80,
        scale: 0.9
    });

    gsap.utils.toArray(".contact__widget__item").forEach((item, i) => {
        gsap.from(item, {
            scrollTrigger: {
                trigger: "#contact",
                start: "top 70%",
                end: "top 45%",
                scrub: 1.5
            },
            opacity: 0,
            x: -50 - (i * 10),
            y: 30,
            scale: 0.95
        });
    });

    const contactFormTl = gsap.timeline({
        scrollTrigger: {
            trigger: "#contact",
            start: "top 70%",
            end: "top 40%",
            scrub: 1.8
        }
    });

    contactFormTl.from(".contact__form", {
        opacity: 0,
        x: 80,
        scale: 0.9
    });

    gsap.from("#send-message-button", {
        scrollTrigger: {
            trigger: ".contact__form",
            start: "top 65%",
            toggleActions: "play none none reverse"
        },
        opacity: 0,
        scale: 0.8,
        y: 20,
        duration: 0.6,
        ease: "back.out(1.2)",
        delay: 0.3
    });

    // Background balls parallax
    gsap.utils.toArray(".ball").forEach((ball, i) => {
        gsap.to(ball, {
            scrollTrigger: {
                trigger: "body",
                start: "top top",
                end: "bottom bottom",
                scrub: 0.8 + (i * 0.3)
            },
            y: (i % 2 === 0 ? 250 : -250) * (1 + i * 0.15),
            ease: "none"
        });

        gsap.to(ball, {
            x: `random(-40, 40)`,
            rotation: `random(-15, 15)`,
            scale: `random(0.85, 1.2)`,
            duration: `random(5, 8)`,
            repeat: -1,
            yoyo: true,
            ease: "sine.inOut",
            delay: i * 0.3
        });
    });

    window.addEventListener('load', () => {
        ScrollTrigger.refresh();
    });
}

$(document).ready(function () {
    setTimeout(() => {
        setupParallaxAnimations();
    }, 300);
});

let resizeTimer;
$(window).on('resize', function () {
    clearTimeout(resizeTimer);
    resizeTimer = setTimeout(() => {
        ScrollTrigger.refresh();
    }, 250);
});